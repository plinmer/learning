# 数据库瓶颈
对于后端程序员来说，绕不开数据库的使用与方案选型，那么随着业务规模的逐渐扩大，其对于存储的使用上也需要随之进行升级和优化。

随着规模的扩大，数据库面临如下问题：

读压力：并发QPS、索引不合理、SQL语句不合理、锁粒度
写压力：并发QPS、事务、锁粒度
物理性能：磁盘瓶颈、CPU瓶颈、内存瓶颈、IO瓶颈
其他：宕机、网络异常
面对上述问题，常见的优化手段有：
    - 索引优化
    - 主从同步
    - 缓存
    - 分库分表
# 为什么需要分库分表
- 性能角度：CPU，内存，磁盘，单机IO，整体系统的并发
    - 数据量增大，索引树庞大，单机查询性能出现瓶颈
    - 单机物理机限制，并发度不高
- 可用性角度
    - 单库的话，一台炸了，系统直接崩溃
# 好的分库分表方案
- 方案的可持续性
- 最小化数据迁移
- 最小化数据倾斜

# 如何进行分库分表
- 垂直拆分
    - 垂直拆表
        大表拆小表，不常用的信息拆分到扩展表中，提高检索效率
    - 垂直拆库
        按照业务进行划分，进一步对应的就是拆分服务模块
- 水平拆分
    - 水平拆表/水平拆库
        将数据按照一定的规则切分成小数据量级，存储到不同的库表中
    - 拆分手段
        - range：时间范围（日志相关流水）
        - hash算法：广告主ID（广告系统），订单ID（订单系统）依赖全局统一的ID

# 分库分表带来的问题及解决方案
- 事务一致性问题：事务执行可能跨库，无法保证事务的一致性
    - 分库拆分的时候，尽量保证事务的操作集中在一个db中
    - 分布式事务
- 跨库多表join问题
    - 全局表：类似那种不怎么修改，量级很小的表可以冗余存储。
    - 业务层处理
- 跨库聚合问题（sort，orderby，limit分页）
    - 难搞，部分可以用归并的思想解决
        


参考文档
- [一文读懂数据库分库分表](https://km.woa.com/articles/show/544092?kmref=search&from_page=1&no=7)
- [mysql 分库分表](https://km.woa.com/articles/show/405492)
